>**ATTENTION**
\
>**Ce document correspond à la version 0.1 du HubSante.**
\
> **Pour tester cette version, veuillez vous placer sur le tag correspondant :**
\
\
> git checkout 0.1

# v0.1: Messages vides et acquittements techniques

## Documentation
- Le DST v0.1.1 contient des informations plus détaillées sur les versions et messages
- La [documentation de Docker](https://docs.docker.com/get-started/overview/)
- Les [tutoriels de RabbitMQ](https://www.rabbitmq.com/getstarted.html) dans le langage de votre choix

## Objectifs
- [ ] Faire tourner la version locale du Hub Santé
  - [Installer docker](https://docs.docker.com/get-docker/)
  - Lancer la commande `docker compose up` pour monter l'infrastructure
  - Vérifier que RabbitMQ est bien actif et accessible en se connectant avec guest:guest à http://localhost:15672
- [ ] Construire un `Producer` capable d'envoyer des messages au Hub Santé
  - Connexion au Hub Santé sur `localhost:5672`
  - Publication sur un exchange `hubsante` en mode `topic` (voir [tutoriel 5](https://www.rabbitmq.com/tutorials/tutorial-five-python.html))
  - *Routing Key* de la forme `$CLIENT_ID.out.$TYPE` avec `$TYPE` parmi message, info, ack
  - Marquer les messages comme persistents (voir [tutoriel 2](https://www.rabbitmq.com/tutorials/tutorial-two-python.html))
- [ ] Construire un `Consumer` capable de lire et acquitter les messages reçus du Hub Santé
  - Connexion au Hub Santé sur `localhost:5672`
  - Consommer d'une queue nommée sous la forme `$CLIENT_ID.in.$TYPE` avec `$TYPE` parmi message, info, ack
  - Acquitter les messages une fois que le Hub Santé ne doit plus tenter de les redélivrer en cas de problème

## Implémentation Java
- [x] Hub Santé local
  - Décrit dans [`docker-compose.yml`](../docker-compose.yml)
  - Logique implémentée dans [`Dispatcher.java`](../src/main/java/com/hubsante/Dispatcher.java)
  - Construit avec `docker compose up --build`, lancé avec `docker compose up` et arrêté avec `Ctrl-C` ou `docker compose down`
- [x] [`Producer.java`](../src/main/java/com/hubsante/Producer.java)
  - Lancé avec `CLIENT_ID=Self-Sante; gradle -Pmain=com.hubsante.Producer run --args "$CLIENT_ID.out.message {'to': '$CLIENT_ID', 'content': 'test'}"`
- [x] [`Consumer.java`](../src/main/java/com/hubsante/Consumer.java)
  - Lancé avec `CLIENT_ID=Self-Sante; gradle -Pmain=com.hubsante.Consumer run --args "$CLIENT_ID.in.message"`

## Test
```
# Shell 1: run Hub Santé locally
docker compose up

# Shell 2: run Consumer
CLIENT_ID=Self-Sante; gradle -Pmain=com.hubsante.Consumer run --args "$CLIENT_ID.in.message"

# Shell 3: run Producer each time you want to send a message
CLIENT_ID=Self-Sante; gradle -Pmain=com.hubsante.Producer run --args "$CLIENT_ID.out.message {'to': '$CLIENT_ID', 'content': 'test'}"

# Test : confirm messages are read by Consumer + messages are correctly acked (through RabbitMQ interface)
```