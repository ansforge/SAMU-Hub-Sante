> **Attention**
>
> **Ce document correspond à la version v0.9 du HubSante.**
>
> Pour tester cette version, veuillez vous placer sur le tag correspondant :
> `git checkout 0.9`

## Changements v0.9
- Simplification des règles de nommage du Hub Santé.

- Ajout d'un contrôle des permissions à publication.

- Ajout d'un mécanisme d'expiration, défini par défaut au niveau du HubSanté, pouvant être raccourci à l'inititative de l'émetteur à l'échelle du message.

- Ajout d'un mécanisme de lettre morte et première implémentation d'une gestion des erreurs.

- Enrichissement de la couverture de tests et automatisation de leur exécution.

- Implémentation d'un mécanisme de génération du modèle objet et des fichiers de spécifications à partir des documents de co-construction.

- Ajout d'une documentation en ligne : documentation générale, spécifications, site de démonstration (première itération)

## Implémentation
- Simplification des règles de nommage du Hub Santé : les différents objets RabbitMQ (exchanges, queues, routing keys) sont simplifiés.
  Utilisation de l'Identifiant Client comme routing key à la publication, sans suffixe. Utilisation d'échangeurs nommés : ***hubsante***
  pour la publication par les clients, ***distribution*** pour la distribution par le Dispatcher sur les files d'écoute, {***IdentifiantClient***}.{***type***}
  pour chaque file d'écoute client.

- Ajout d'un contrôle des permissions à publication : enrichissement du [fichier de configuration](../hub/rabbitmq/definitions.json) RabbitMQ avec des ***topic_permissions*** sur les échangeurs.
  Cette mécanique permet de contrôler que la routing key utilisée à la publication par un utilisateur authentifié et autorisé correspond bien à son ***IdentifiantClient***.

- Ajout d'un mécanisme d'expiration : Une durée de vie maximale des messages est définie par une policy RabbitMQ et s'applique à toutes les files d'écoute client.
  Un mécanisme de contrôle du champ ***dateTimeExpires*** de l'enveloppe EDXL permet de surcharger cette durée de vie si la valeur déduite de ce champ est plus courte.

- Ajout d'un mécanisme de lettre morte : les messages ayant transité avec succès par le Dispatcher mais n'ayant pu être dépilés par le destinataire
  (en raison d'un échec côté client, ou par expiration) sont déplacés sur une file de lettre morte.

- Première implémentation d'une gestion des erreurs : les messages déplacés sur la file de lettre morte sont dépilés par le [Dispatcher](../hub/dispatcher/src/main/java/com/hubsante/hub/service/Dispatcher.java) de façon à pouvoir générer
  la publication d'un message d'information sur la file {***IdentifiantClient***}.info de l'expéditeur. Les messages ayant été rejetés par le Dispatcher
  avant transmission sur la file d'écoute du destinataire (erreurs liées au Content-Type du message, à la validation du format du message métier, etc.)
  entraînent également la publication d'un message d'information à destination de l'émetteur.
  
  Cette première implémentation repose sur l'envoi d'un message d'information non typé, qui sera à terme remplacé par un message structuré.

## Documentation

